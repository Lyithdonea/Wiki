/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.create;var D=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var _=i=>D(i,"__esModule",{value:!0});var W=(i,e)=>{_(i);for(var t in e)D(i,t,{get:e[t],enumerable:!0})},$=(i,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Q(e))!j.call(i,s)&&s!=="default"&&D(i,s,{get:()=>e[s],enumerable:!(t=F(e,s))||t.enumerable});return i},H=i=>$(_(D(i!=null?I(z(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);var k=(i,e,t)=>new Promise((s,l)=>{var r=a=>{try{o(t.next(a))}catch(d){l(d)}},n=a=>{try{o(t.throw(a))}catch(d){l(d)}},o=a=>a.done?s(a.value):Promise.resolve(a.value).then(r,n);o((t=t.apply(i,e)).next())});W(exports,{default:()=>q});function g(i,e){let t=Object.keys(e).map(s=>G(i,s,e[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function G(i,e,t){let s=i[e],l=i.hasOwnProperty(e),r=t(s);return s&&Object.setPrototypeOf(r,s),Object.setPrototypeOf(n,r),i[e]=n,o;function n(...a){return r===s&&i[e]===n&&o(),r.apply(this,a)}function o(){i[e]===n&&(l?i[e]=s:delete i[e]),r!==s&&(r=s,Object.setPrototypeOf(n,s||Function))}}var c=H(require("obsidian"));var v=H(require("obsidian")),N=v.requireApiVersion&&(0,v.requireApiVersion)("0.15.0"),B=class extends v.MarkdownRenderer{constructor(e,t,s){super(e,t);this.app=e,this.match=s,this.subpath="",this.indent="",this.filePath=N?this.match.parentDom.path:this.match.parent.path,this.file=N?this.match.parentDom.file:this.match.parent.file,this.renderer.previewEl.onNodeInserted(()=>(this.updateOptions(),this.renderer.onResize()))}updateOptions(){let e=this.app.vault.getConfig("readableLineLength");this.renderer.previewEl.toggleClass("is-readable-line-width",e);let t=this.app.vault.getConfig("foldHeading");this.renderer.previewEl.toggleClass("allow-fold-headings",t);let s=this.app.vault.getConfig("foldIndent");this.renderer.previewEl.toggleClass("allow-fold-lists",s),this.renderer.previewEl.toggleClass("rtl",this.app.vault.getConfig("rightToLeft")),t||this.renderer.unfoldAllHeadings(),s||this.renderer.unfoldAllLists(),this.renderer.previewEl.toggleClass("show-frontmatter",this.app.vault.getConfig("showFrontmatter"));let l=this.app.vault.getConfig("tabSize");this.renderer.previewEl.style.tabSize=String(l),this.renderer.rerender()}onRenderComplete(){}getFile(){return this.match.parent.file}edit(e){return k(this,null,function*(){var a;this.renderer.set(e);let t=yield this.app.vault.cachedRead(this.file),l=(a=t.slice(this.match.start,this.match.end).match(/^\s+/g))==null?void 0:a.first();l&&(e=e.replace(/^/gm,l));let r=t.slice(0,this.match.start),n=t.slice(this.match.end,this.match.parent.content.length);var o=r+e+n;this.app.vault.modify(this.file,o)})}};var w=H(require("obsidian"));var m=i18next.t.bind(i18next);var V={defaultCollapse:!1,defaultShowContext:!1,defaultHideTitle:!1,defaultHideResults:!1,defaultRenderMarkdown:!1,defaultSortOrder:"alphabetical"},x={alphabetical:m("plugins.file-explorer.label-sort-a-to-z"),alphabeticalReverse:m("plugins.file-explorer.label-sort-z-to-a"),byModifiedTime:m("plugins.file-explorer.label-sort-new-to-old"),byModifiedTimeReverse:m("plugins.file-explorer.label-sort-old-to-new"),byCreatedTime:m("plugins.file-explorer.label-sort-created-new-to-old"),byCreatedTimeReverse:m("plugins.file-explorer.label-sort-created-old-to-new")},A=class extends w.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}hide(){}display(){let{containerEl:e}=this;e.empty(),new w.Setting(e).setName("Collapse query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultCollapse).onChange(s=>{this.plugin.settings.defaultCollapse=s,this.plugin.saveSettings()})),new w.Setting(e).setName("Show additional query result context by default").addToggle(t=>t.setValue(this.plugin.settings.defaultShowContext).onChange(s=>{this.plugin.settings.defaultShowContext=s,this.plugin.saveSettings()})),new w.Setting(e).setName("Hide query title by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideTitle).onChange(s=>{this.plugin.settings.defaultHideTitle=s,this.plugin.saveSettings()})),new w.Setting(e).setName("Hide query results by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideResults).onChange(s=>{this.plugin.settings.defaultHideResults=s,this.plugin.saveSettings()})),new w.Setting(e).setName("Render results as Markdown by default").addToggle(t=>t.setValue(this.plugin.settings.defaultRenderMarkdown).onChange(s=>{this.plugin.settings.defaultRenderMarkdown=s,this.plugin.saveSettings()})),new w.Setting(e).setName("Default query result sort order").addDropdown(t=>{t.addOptions(x),t.setValue(this.plugin.settings.defaultSortOrder),t.onChange(s=>k(this,null,function*(){this.plugin.settings.defaultSortOrder=s,yield this.plugin.saveSettings()}))})}};var C=c.requireApiVersion&&(0,c.requireApiVersion)("0.15.0"),ye=new WeakMap,L=new WeakMap,q=class extends c.Plugin{onload(){return k(this,null,function*(){yield this.loadSettings();let e=this;this.registerSettingsTab(),this.register(g(this.app.viewRegistry.constructor.prototype,{registerView(s){return function(l,r,...n){return e.app.workspace.trigger("view-registered",l,r),s.call(this,l,r,...n)}}}));let t;if(this.app.workspace.layoutReady)this.getSearchExport();else{let s=this.app.workspace.on("view-registered",(r,n)=>{if(r!=="search")return;this.app.workspace.offref(s);let o=new c.WorkspaceLeaf(e.app),a=n(o);e.patchNativeSearch(a);let d=g(c.Modal.prototype,{open(p){return function(...u){e.SearchResultsExport=this.constructor}}});a.onCopyResultsClick(new MouseEvent(null)),d()}),l=this.app.workspace.on("view-registered",(r,n)=>{if(r!=="backlink")return;this.app.workspace.offref(l);let o=new c.WorkspaceLeaf(e.app),a=n(o);e.SearchHeaderDOM=a.backlink.headerDom.constructor})}this.register(t=g(c.Component.prototype,{addChild(s){return function(l,...r){try{if(!e.isSearchPatched&&l instanceof c.Component&&l.hasOwnProperty("searchQuery")&&l.hasOwnProperty("sourcePath")&&l.hasOwnProperty("dom")){let o=l;e.patchSearchView(o),e.isSearchPatched=!0}if(l instanceof c.Component&&l.hasOwnProperty("backlinkDom")){let o=l;L.set(o.backlinkDom.el.closest(".backlink-pane"),l),e.isBacklinksPatched||(e.patchBacklinksView(o),e.isBacklinksPatched=!0)}}catch(o){console.log(o)}return s.call(this,l,...r)}}}))})}loadSettings(){return k(this,null,function*(){this.settings=Object.assign({},V,yield this.loadData())})}saveSettings(){return k(this,null,function*(){yield this.saveData(this.settings)})}registerSettingsTab(){this.settingsTab=new A(this.app,this),this.addSettingTab(this.settingsTab)}getSearchHeader(){var t,s,l,r;let e=(r=(l=(s=(t=this.app.workspace.getLeavesOfType("backlink"))==null?void 0:t.first())==null?void 0:s.view)==null?void 0:l.backlink)==null?void 0:r.headerDom;return e==null?void 0:e.constructor}getSearchExport(){var l,r;let e=this,t=(r=(l=this.app.workspace.getLeavesOfType("search"))==null?void 0:l.first())==null?void 0:r.view,s=g(c.Modal.prototype,{open(n){return function(...o){e.SearchResultsExport=this.constructor}}});t==null||t.onCopyResultsClick(new MouseEvent(null)),s()}onunload(){}patchNativeSearch(e){let t=this;this.register(g(e.constructor.prototype,{onResize(s){return function(...l){var n;let r=C?(n=this.dom.vChildren)==null?void 0:n._children:this.dom.children;return this.dom.el.clientWidth===0?(r.forEach(o=>{o.setCollapse(!0,!1)}),this.dom.hidden=!0):this.dom.hidden&&(this.dom.hidden=!1,setTimeout(()=>{r.forEach(o=>{o.setCollapse(this.dom.collapseAll,!1)})},100)),s.call(this,...l)}},stopSearch(s){return function(...l){let r=s.call(this,...l);return this.renderComponent&&(this.renderComponent.unload(),this.renderComponent=new c.Component),r}},addChild(s){return function(...l){var n;try{if(!this.patched){this.renderComponent||(this.renderComponent=new c.Component,this.renderComponent.load()),this.patched=!0,this.dom.parent=this,t.patchSearchResultDOM(this.dom.constructor),this.setRenderMarkdown=function(a){var p,u;let d=C?(p=this.dom.vChildren)==null?void 0:p._children:this.dom.children;this.dom.renderMarkdown=a,d.forEach(f=>{f.renderContentMatches()}),this.dom.infinityScroll.invalidateAll(),this.dom.childrenEl.toggleClass("cm-preview-code-block",a),this.dom.childrenEl.toggleClass("is-rendered",a),(u=this.renderMarkdownButtonEl)==null||u.toggleClass("is-active",a)},this.renderMarkdownButtonEl=(n=this.headerDom)==null?void 0:n.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.dom.renderMarkdown));let o={renderMarkdown:t.settings.defaultRenderMarkdown};this.settings||(this.settings={}),Object.entries(o).forEach(([a,d])=>{this.settings.hasOwnProperty(a)?a==="sort"&&!x.hasOwnProperty(this.settings.sort)&&(this.settings[a]=d):this.settings[a]=d}),this.setRenderMarkdown(this.settings.renderMarkdown)}}catch(o){console.log(o)}return s.call(this,...l)}}}))}patchSearchResultDOM(e){let t=this,s=g(e.prototype,{addResult(l){return function(...r){s();let n=l.call(this,...r),o=n.constructor;return t.isSearchResultItemPatched||t.patchSearchResultItem(o),n}}});this.register(s),this.register(g(e.prototype,{startLoader(l){return function(...r){var o,a,d,p,u,f;try{let R=this.el.closest(".backlink-pane"),P=L.get(R);if(R&&P&&(P.patched||U(this,t,R,P)),!((a=(o=this.parent)==null?void 0:o.searchParamsContainerEl)==null?void 0:a.patched)&&((p=(d=this.el)==null?void 0:d.parentElement)==null?void 0:p.getAttribute("data-type"))==="search"&&(this.parent.searchParamsContainerEl.patched=!0,new c.Setting(this.parent.searchParamsContainerEl).setName("Render Markdown").setClass("mod-toggle").addToggle(O=>{O.setValue(t.settings.defaultRenderMarkdown),O.onChange(M=>{var T;this.renderMarkdown=M,(C?(T=this.vChildren)==null?void 0:T._children:this.children).forEach(h=>{h.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",M),this.childrenEl.toggleClass("is-rendered",M)})})),!this.patched&&((u=this.el.parentElement)==null?void 0:u.hasClass("internal-query"))){let O=t.SearchHeaderDOM?t.SearchHeaderDOM:t.getSearchHeader();if((f=this.el)==null?void 0:f.closest(".internal-query")){this.patched=!0;let M=this.el.parentElement.querySelector(".internal-query-header");this.setExtraContext=function(h){var S;let E=C?(S=this.vChildren)==null?void 0:S._children:this.children;this.extraContext=h,this.extraContextButtonEl.toggleClass("is-active",h),E.forEach(b=>{b.setExtraContext(h)}),this.infinityScroll.invalidateAll()},this.setTitleDisplay=function(h){this.showTitle=h,this.showTitleButtonEl.toggleClass("is-active",h),M.toggleClass("is-hidden",h)},this.setResultsDisplay=function(h){this.showResults=h,this.showResultsButtonEl.toggleClass("is-active",h),this.el.toggleClass("is-hidden",h)},this.setRenderMarkdown=function(h){var S;this.renderMarkdown=h,(C?(S=this.vChildren)==null?void 0:S._children:this.children).forEach(b=>{b.renderContentMatches()}),this.infinityScroll.invalidateAll(),this.childrenEl.toggleClass("cm-preview-code-block",h),this.childrenEl.toggleClass("is-rendered",h),this.renderMarkdownButtonEl.toggleClass("is-active",h)},this.setCollapseAll=function(h){var S;let E=C?(S=this.vChildren)==null?void 0:S._children:this.children;this.collapseAllButtonEl.toggleClass("is-active",h),this.collapseAll=h,E.forEach(b=>{b.setCollapse(h,!1)}),this.infinityScroll.invalidateAll()},this.setSortOrder=h=>{this.sortOrder=h,this.changed(),this.infinityScroll.invalidateAll()},this.onCopyResultsClick=h=>{h.preventDefault(),new t.SearchResultsExport(this.app,this).open()};let y=this.headerDom=new O(this.app,this.el.parentElement);M.insertAdjacentElement("afterend",y.navHeaderEl),this.collapseAllButtonEl=y.addNavButton("bullet-list",m("plugins.search.label-collapse-results"),()=>this.setCollapseAll(!this.collapseAll)),this.extraContextButtonEl=y.addNavButton("expand-vertically",m("plugins.search.label-more-context"),()=>this.setExtraContext(!this.extraContext)),y.addSortButton(h=>this.setSortOrder(h),()=>this.sortOrder),this.showTitleButtonEl=y.addNavButton("strikethrough-glyph","Hide title",()=>this.setTitleDisplay(!this.showTitle)),this.showResultsButtonEl=y.addNavButton("minus-with-circle","Hide results",()=>this.setResultsDisplay(!this.showResults)),this.renderMarkdownButtonEl=y.addNavButton("reading-glasses","Render Markdown",()=>this.setRenderMarkdown(!this.renderMarkdown)),y.addNavButton("documents","Copy results",this.onCopyResultsClick.bind(this));let T={title:t.settings.defaultHideResults,collapsed:t.settings.defaultCollapse,context:t.settings.defaultShowContext,hideTitle:t.settings.defaultHideTitle,hideResults:t.settings.defaultHideResults,renderMarkdown:t.settings.defaultRenderMarkdown,sort:t.settings.defaultSortOrder};this.settings||(this.settings={}),Object.entries(T).forEach(([h,E])=>{this.settings.hasOwnProperty(h)?h==="sort"&&!x.hasOwnProperty(this.settings.sort)&&(this.settings[h]=E):this.settings[h]=E}),this.setExtraContext(this.settings.context),this.sortOrder=this.settings.sort,this.setCollapseAll(this.settings.collapsed),this.setTitleDisplay(this.settings.hideTitle),this.setRenderMarkdown(this.settings.renderMarkdown),this.setResultsDisplay(this.settings.hideResults)}}}catch(R){console.log(R)}return l.call(this,...r)}}}))}patchSearchResultItem(e){this.isSearchResultItemPatched=!0;let t=this,s=g(e.prototype,{onResultClick(l){return function(r,n,...o){if(!(r.target instanceof HTMLElement&&(r.target.hasClass("internal-link")||r.target.hasClass("task-list-item-checkbox")||r.target.hasClass("admonition-title-content"))))return l.call(this,r,n,...o)}},renderContentMatches(l){return function(...r){var a;let n=l.call(this,...r),o=C?(a=this.vChildren)==null?void 0:a._children:this.children;if(!t.isSearchResultItemMatchPatched&&o.length){let d=o.first().constructor;t.patchSearchResultItemMatch(d)}return n}}});t.register(s)}patchSearchResultItemMatch(e){this.isSearchResultItemMatchPatched=!0;let t=this;t.register(g(e.prototype,{render(s){return function(...l){var d;let r=C?this.parentDom:this.parent,n=r.content.substring(this.start,this.end).replace("```query","\\`\\`\\`query"),o=(d=n.match(/^\s+/g))==null?void 0:d.first();o&&(n=n.replace(new RegExp(`^${o}`,"gm"),""));let a=r.parent.parent;if(a&&r.parent.renderMarkdown){let p=a==null?void 0:a.renderComponent;this.el.empty();let u=new B(t.app,this.el,this);u.onRenderComplete=()=>{var f;(f=r==null?void 0:r.parent)==null||f.infinityScroll.measure(r,this)},p.addChild(u),u.renderer.set(n)}else return s.call(this,...l)}}}))}patchSearchView(e){let t=this,s=e.constructor,l=e.dom.constructor;this.register(g(s.prototype,{onunload(r){return function(...n){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),r.call(this,...n)}},onload(r){return function(...n){try{this.renderComponent||(this.renderComponent=new c.Component,this.renderComponent.load()),this.dom.parent=this;let a=this.containerEl.parentElement.querySelector(".internal-query-header"),d=this.query.matchAll(/^(?<key>collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):\s*(?<value>.+?)$/gm),p={};for(let u of d){let f=u.groups.value.toLowerCase();(f==="true"||f==="false")&&(u.groups.value=f==="true"),p[u.groups.key]=u.groups.value}this.query=this.query.replace(/^((collapsed|context|hideTitle|renderMarkdown|hideResults|sort|title):.+?)$/gm,"").trim(),a.setText(p.title||this.query),this.dom.settings=p}catch(a){}return r.call(this,...n)}}})),this.patchSearchResultDOM(l)}patchBacklinksView(e){let t=this,s=e.constructor,l=e.backlinkDom.constructor;this.register(g(s.prototype,{onunload(r){return function(...n){return this.renderComponent&&(this.renderComponent.unload(),this.dom=null,this.queue=null,this.renderComponent=null,this._children=null,this.containerEl=null),r.call(this,...n)}},onload(r){return function(...n){try{this.renderComponent||(this.renderComponent=new c.Component,this.renderComponent.load()),this.backlinkDom.parent=this,this.unlinkedDom.parent=this;let a={};this.dom.settings=a}catch(a){}return r.call(this,...n)}}})),this.patchSearchResultDOM(l)}};function U(i,e,t,s){if(s){s.patched=!0;let l=t.querySelector(".internal-query-header")||t.querySelector(".nav-header");i.setRenderMarkdown=function(n){[s.backlinkDom,s.unlinkedDom].forEach(a=>{var p;a.renderMarkdown=n,(C?(p=a.vChildren)==null?void 0:p._children:a.children).forEach(u=>{u.renderContentMatches()}),a.infinityScroll.invalidateAll(),a.childrenEl.toggleClass("cm-preview-code-block",n),a.childrenEl.toggleClass("is-rendered",n)}),this.renderMarkdownButtonEl.toggleClass("is-active",n)},i.onCopyResultsClick=n=>{n.preventDefault(),new e.SearchResultsExport(i.app,i).open()},i.renderMarkdownButtonEl=s.headerDom.addNavButton("reading-glasses","Render Markdown",()=>i.setRenderMarkdown(!i.renderMarkdown)),s.headerDom.addNavButton("documents","Copy results",i.onCopyResultsClick.bind(i));let r={title:e.settings.defaultHideResults,collapsed:e.settings.defaultCollapse,context:e.settings.defaultShowContext,hideTitle:e.settings.defaultHideTitle,hideResults:e.settings.defaultHideResults,renderMarkdown:e.settings.defaultRenderMarkdown,sort:e.settings.defaultSortOrder};i.settings||(i.settings={}),Object.entries(r).forEach(([n,o])=>{i.settings.hasOwnProperty(n)?n==="sort"&&!x.hasOwnProperty(i.settings.sort)&&(i.settings[n]=o):i.settings[n]=o}),s.setExtraContext(i.settings.context),s.sortOrder=i.settings.sort,s.setCollapseAll(i.settings.collapsed),i.setRenderMarkdown(i.settings.renderMarkdown)}}
